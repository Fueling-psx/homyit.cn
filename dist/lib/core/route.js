define(function(require,exports,module){function t(t){g&&g()}function n(n){n&&(g=n),$(window).on("hashchange",t)}function o(n){$(window).off("hashchange",t)}function r(t){return t?HY.route.now.params[t]:HY.route.now.params}function e(t,o){var r=function(){t(),n(t)};o=o||location.hash,o.indexOf(v.root)!==-1?r():i(r)}function i(t){setTimeout(function(){location.hash=v.root,setTimeout(function(){t&&t()},10)},10)}function a(t){var n="";if($.isPlainObject(t.params))for(var o in t.params)n+="&"+o+"="+t.params[o];var r=v.root+t.module+"/"+t.action+n;return r}function u(t,r){var e="",i=c(t)?t:l(t);return r&&$.extend(i,{options:r}),e=a(i),e!==location.hash&&void setTimeout(function(){o(),location.hash=e,g(i),setTimeout(n,20)},20)}function s(t){t=t||location.hash;var n="/"+t.replace(v.root,"").replace(/^#?\/?/,""),o=n.split("&")[0],r=n.split(o)[1],e={rule:o,params:o[1]?h.get("#","#"+r):{}};return e}function c(t){return!!($.isPlainObject(t)&&t.module&&t.action)&&(!t.options&&(t.options={}),!t.params&&(t.params={}),t.module.split("/").forEach(function(n){if(/^(_|tpl_|css_)/.test(n))return m.error("HY/module_checkDist:","Invalid module name ["+t.module+"]!"),!1}),!0)}function l(t){var n=s(t);if("/"===n.rule)return{isRoot:!0};var o=p(n.rule,n.params);if(o)return o;var r=n.rule.replace(/^\//,"").split("/");return r.length<2?i():{rule:n.rule,module:r.slice(0,r.length-1).join("/"),action:r[r.length-1],params:n.params,options:{}}}function f(t,n){if("string"!=typeof t&&!(t instanceof RegExp))return!1;var o={rule:t};$.isFunction(n)?o.cb=n:$.isPlainObject(n)&&(o.dist=n),d.push(o)}function p(t){var n,o;if("string"==typeof t){var r=s(t);n=r.rule,o=r.params}else n=t.rule,o=t.params;var e=function(t){return $.isFunction(d[i].cb)?d[i].cb():!!c(t.dist)&&(o&&$.extend(t.dist,{rule:t.rule,params:o}),t.dist)};for(var i in d){var a=d[i].rule;if("string"!=typeof a&&a===n)return e(d[i]);if(a instanceof RegExp&&a.test(n))return e(d[i])}return!1}var m=require("./base"),h=require("url");module.exports={init:e,go:u,goRoot:i,getDist:l,reg:f,custom:p,checkDist:c,getParams:r};var d=window.HY.route.customRules,v={root:"#!/"},g=$.noop});